<%- include('../includes/header.ejs', {titulo: 'Painel Administrativo üéª' }) %>

    <main >
    <h1 class="text-3xl font-semibold bg-[#7A552F] text-[#DCCFC2] py-4 shadow text-center"
    style="text-shadow: 2px 2px 3px #3B2A20;">
    Painel Administrativo
</h1>
    </main>

    <!-- CARDS INDICADORES -->
    <section class="grid grid-cols-1 md:grid-cols-4 gap-5 mb-8 mt-5 m-10 ">
        <div class="bg-[#DCCFC2] p-6 shadow rounded-lg text-center mt-4 border-l-4 border-[#986A4C] hover:scale-110 transition-all duration-30" >
            <h4 class="text-gray-600 font-medium">Total de Instrumentos</h4>
            <p class="text-4xl font-bold text-[#6A3F26] mt-3">
                <%= total_produtos %>
            </p>
        </div>
        <div class="bg-[#DCCFC2] p-6 shadow rounded-lg text-center mt-4 border-l-4 border-[#986A4C] hover:scale-110 transition-all duration-30"  >
            <h4 class="text-gray-600 font-medium">Total de Usu√°rios</h4>
            <p class="text-4xl font-bold text-[#6A3F26] mt-3">
                <%= total_usuarios %>
            </p>
        </div>
        <div class="bg-[#DCCFC2] p-6 shadow rounded-lg text-center mt-4 border-l-4 border-[#986A4C] hover:scale-110 transition-all duration-30" >
            <h4 class="text-gray-600 font-medium">Instrumentos no Estoque</h4>
            <p class="text-4xl font-bold text-[#6A3F26] mt-3"> 
               <%= total_estoque %>
            </p>
        </div>
        <div class="bg-[#DCCFC2] p-6 shadow rounded-lg text-center mt-4 border-l-4 border-[#986A4C] hover:scale-110 transition-all duration-30" >
            <h4 class="text-gray-600 font-medium"> Qtd Movimenta√ß√µes </h4>
            <p class="text-4xl font-bold text-[#6A3F26] mt-3">
                <%= total_movimentacoes %>
            </p>
        </div>
    </section>

    <!-- GR√ÅFICOS -->
    <section class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8 m-10">

        <!-- GR√ÅFICO DE COMPRAS POR CATEGORIAS -->
        <div class="bg-[#DCCFC2] shadow rounded-lg  ">
            <p class="bg-[#7A552F] text-white p-4 rounded-t-lg">Quantidade de Instrumentos</p>
            <canvas id="graficoInstrumentos"></canvas>
        </div>

        <!-- GR√ÅFICO DE CATEGORIAS -->
        <div class="bg-[#DCCFC2] shadow rounded-lg ">
            <p class="bg-[#7A552F] text-white p-4 rounded-t-lg"> Instrumentos por Categorias</p>
            <canvas id="graficoCategorias" class="max-h-80"></canvas>
        </div>
    </section>


    <!-- TABELA DE ESTOQUE BAIXO  -->
    <section class="mb-5 m-10 gap-20 ">
        <div class="bg-[#D9C2A8] shadow rounded-lg pb-3">
            <p class="bg-[#7A552F] text-white p-4 rounded-t-lg flex justify-center"> Produtos com Estoque baixo </p>

            <div class="flex justify-center">
                <table class="dados-table">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Categoria</th>
                        <th>Quantidade</th>
                        <th>Quantidade Minima</th>

                    </tr>
                </thead>
                <tbody>
                    <% for (let produto of produtosEstoqueBaixo){ %>
                        <tr>
                            <td>
                                <%= produto.nome_produto %>
                            </td>
                            <td>
                                <%= produto.nome_categoria %>
                            </td>
                            <td>
                                <%= produto.estoque_atual %>
                            </td>
                            <td>
                                <%= produto.estoque_min %>
                            </td>
                        </tr>
                        <% } %>
                </tbody>
            </table>
            </div>
            

        </div>
    </section>

    </main>

    <script>
    // Dados vindos do backend
    const instrumentos = <%- JSON.stringify(instrumentos) %>;
    const categorias = <%- JSON.stringify(categorias) %>;

    // Gr√°fico de instrumentos (barra)
const graficoInstrumentos = document.getElementById('graficoInstrumentos').getContext('2d');

new Chart(graficoInstrumentos, {
    type: 'bar',
    data: {
        labels: instrumentos.map(item => item.nome_produto),
        datasets: [{
            label: 'Estoque Atual',
            data: instrumentos.map(item => item.estoque_atual),
            backgroundColor: [
                '#C89F76', '#B7834F', '#A46634', '#8A5630', '#6A3F26',
                '#594030', '#3B2A20', '#A97458', '#8C5836', '#4A3526'
            ],
            borderColor: '#DCCFC2',
        }]
    },
    options: {
        responsive: true,
        plugins: {
            title: {
                display: true,
                text: 'Instrumentos em Estoque'
            }
        },
        scales: {
            y: {
                grid: {
                    color: '#CBB9A5'
                },
                ticks: {
                    color: '#4B2E2B',
                    font: { size: 12 }
                }
            },
            x: {
                grid: {
                    color: 'rgba(203, 185, 165, 0.4)'
                },
                ticks: {
                    color: '#4B2E2B',
                    font: { size: 12 }
                }
            }
        }
    }
});

    // Gr√°fico de categorias (pizza)
    const graficoCategorias = document.getElementById('graficoCategorias').getContext('2d');
    new Chart(graficoCategorias, {
        type: 'pie',
        data: {
            labels: categorias.map(item => item.nome_categoria),
            datasets: [{
                label: 'Produtos por Categoria',
                data: categorias.map(item => item.qtd_produtos),
                backgroundColor: [
                    '#C58A5E', '#A66A3D', '#8B4E28', '#623A28',
                    '#C69456', '#A76B3C', '#814C2A', '#593725'
                ],
                borderColor: '#DCCFC2',

            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: { display: true, text: 'Quantidade de Produtos por Categoria' }
            }
        }
    });
</script>


    <%- include('../includes/footer.ejs') %>